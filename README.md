# AdSet Service

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ Ad Set –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∏—Å–∫–∞ –ø–æ –¥–µ—Ä–µ–≤—É —É—Å–ª–æ–≤–∏–π —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º.

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### üìå –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Node.js (v18+)
- PostgreSQL
- Redis
- Yarn (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```sh
yarn install
```

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —É–∫–∞–∂–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```
APP_PORT=port

DB_HOST=host
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=adset_db

REDIS_HOST=host
REDIS_PORT=6379
```

### üì¶ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞:
#### –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```sh
yarn start:dev
```

#### –í –ø—Ä–æ–¥–∞–∫—à–Ω:
```sh
yarn start:prod
```

#### yarn build –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–º–∞–Ω–¥—ã

### üõ†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π:
```sh
MIGRATION_NAME=<name> yarn migration:generate
```
#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:
```sh
yarn migration:run
```
#### –£–¥–∞–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:
```sh
yarn migration:down //—É–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
yarn migration:dropAll //–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```

### üìù API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- **GET `/adset?geo=RU&device=mobile`** ‚Äì –ø–æ–ª—É—á–∏—Ç—å AdSet –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **POST `/adset/probability`** ‚Äì –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–∑–ª–∞

### –ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å GET –∑–∞–ø—Ä–æ—Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –±–¥ —Å–≤–æ–∏–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
``` sh
INSERT INTO tree_node (name, conditions, probability, type, parent_id) VALUES   ('Node 1', '{"geo": "RU", "device": "mobile"}', 0.5, 'type1', 1),  ('Node 2', '{"geo": "US", "device": "desktop"}', 0.5, 'type2', 1);
```
---
üí° *–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NestJS, TypeORM, Redis –∏ PostgreSQL.*
